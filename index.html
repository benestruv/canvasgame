<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Jeux d'obstacle</title>

    <!--Stylisation de l'aire du jeu-->
    <style>
        canvas{
            /* border: 15px solid #000; */
            background: linear-gradient(to bottom, #163275 0%,#163275 58%,#7db9e8 88%,#357c18 96%,#357c18 100%);
            margin: 0 auto;

        }
    </style>

</head>
<body onload="startGame()"> <!--Cette fonction est lancée à chaque chargement de la page-->

    <audio src="mouton.mp3" id="audio"></audio>
    <audio src="death.mp3" id="audio2"></audio>

    <script type="text/javascript">

    // Définition des variables

    // Les obstacles (leurs tailles, écarts)
    minHeight = 20;
    maxHeight = 100;
    minWidth = 10;
    maxWidth = 20;
    minGap = 200;
    maxGap = 500;
    gap=randGap();
    // Création d'un tableau d'obstacle
    var myObstacles=[];
    var audio=document.getElementById("audio");
    var audio1=document.getElementById("audio1");


    // Le jeu
        function startGame(){
            gamearea.start();
            image=new Image();
            image.src="sheep.png";
        }

        function everyinterval(n){
            if(gamearea.frame%n==0) return true;
            return false;
        }

        function jump(){
            player.speedY-=2;
            audio.play();
        }

        function randGap(){
            return Math.floor(minGap+Math.random()*(maxGap-minGap+1));
        }

        var scoreText={
            x:900,
            y:50,
            update:function(text){
                gamearea.context.fillStyle="white";
                gamearea.context.font="30px Consolas";
                gamearea.context.fillText(text,this.x,this.y);
            }
        }

// Ajoutons le joueur !!!
        var player={
            x:20,
            y:470,
            speedY:0,
            update:function(){
                // gamearea.context.fillStyle="black";
                // gamearea.context.fillRect(this.x,this.y,30,30);
                gamearea.context.drawImage(image,this.x,this.y,30,30);
            },
            newPos:function(){ // définition du saut et du retour
                if(this.y<280){
                    this.speedY=2;
                }
                this.y=this.y+this.speedY;
                if(this.speedY==2 && this.y==470){
                    this.speedY=0;
                }
            },
            crashWith:function(obs){
                if(this.x+30>obs.x && this.x<obs.x+obs.width && this.y+30>obs.y){
                    alert("Sheep over !");
                    audio1.play();
                    return true;
                }
                return false;
            }

        }
        
        // Ici nous allons créer nos obstacles
        function obstacle(){
            this.height=Math.floor(minHeight+Math.random()*(maxHeight-minHeight+1)); // Une valeur random entre maxHeight et minHeight
            this.width=Math.floor(minWidth+Math.random()*(maxWidth-minWidth+1));
        
        // Dessinons un obstacle à présent !
            this.x=1200;
            this.y=gamearea.canvas.height-this.height;
            this.draw=function(){
                gamearea.context.fillStyle="brown";
                gamearea.context.fillRect(this.x,this.y,this.width,this.height);
            }
        }
            

        var gamearea = { // Cette variable contient le jeu entier
            canvas:document.createElement("canvas"),
            start:function(){ // dans start, on ajoute toutes les actions initiales
                this.canvas.height = 500;
                this.canvas.width = 1200;
                // Ajouter le canvas dans la section body du html
                document.body.insertBefore(this.canvas,document.body.childNodes[0]);
                // context est l'outil utilisé pour dessiner
                this.context = this.canvas.getContext("2d");
                // // Ajouter un obstacle au tableau
                // myObstacles.push(new obstacle());
                this.frame=0;
                this.score=0;
                scoreText.update("Score: 0");
                // Exécute "updateGameArea" toutes les 5 milisecondes (taux de raffraichissement du jeu)
                this.interval=setInterval(this.updateGameArea,5);
                window.addEventListener("keydown",jump);
            },
            // les changements dans la zone de jeu
            updateGameArea:function(){
                for(i=0;i<myObstacles.length;i++){
                    if(player.crashWith(myObstacles[i])){
                        gamearea.stop();
                        return;
                    }
                }


                gamearea.clear(); // empêche les trainées
                // plus d'obstacles
                if(everyinterval(gap)){ // après 150 fois
                    myObstacles.push(new obstacle());
                    gap=randGap();
                    gamearea.frame=0;
                }
                for(i=0;i<myObstacles.length;i++){
                    myObstacles[i].x-=1; // L'objet se décrémente de 1 tous les x temps
                    myObstacles[i].draw();    
                };
                player.newPos();
                player.update();
                gamearea.frame+=1;
                gamearea.score+=0.01;
                scoreText.update("Score: "+Math.floor(gamearea.score));
            },
            // clear dessins zone de jeu (sinon trainées)
            clear:function(){
                gamearea.context.clearRect(0,0,this.canvas.width,this.canvas.height) // clearRect dégage un rectangle équialent aux coordonées données
            },
            stop:function(){ // fin du jeu
                clearinterval(this.interval);
                
            }
        } 
    </script>
    
</body>
</html>